In this chapter we study another new model of fixed-size coalition formation, which we call the \emph{Three-Dimensional Roommates with $\mathscr{W}$-preferences} (\mysymbolfirstusedefinition{symboldef:threedr_w}{3DR-W}). This model is in a sense dual to the \emph{Three-Dimensional Roommates with $\mathscr{B}$-preferences} (3DR-B), which we considered in Chapter~\ref{c:threed_sr_b}. As in 3DR-B, in 3DR-W each agent supplies a strict preference list over all other agents and uses a set extension rule to compare coalitions. In 3DR-W, the set extension rule used is known as \emph{$\mathscr{W}$-preferences} \cite{CH04} and means that any agent prefers some triple $S$ to another triple $T$ if the least-preferred agent in $S$ is more preferred than the least-preferred agent in $T$. In this chapter we consider in 3DR-W the existence of, and complexity of finding, matchings that are stable.

We first show, in Section~\ref{sec:threed_sr_w_hardness}, that a given instance of 3DR-W may not contain a stable matching and that the associated decision problem is $\NP$-complete (Theorem~\ref{thm:threed_sr_w_existence}). As in the case of 3DR-B, this also contrasts with an analogous model involving $\mathscr{W}$-preferences in which coalitions need not have a fixed size, in which a stable matching must exist and can be found in polynomial time \cite{CH04}. It may seem intuitive that the additional requirement of fixed-size coalitions makes this particular problem harder to solve, and this result gives another example of a model in which that intuition holds.

We then consider, in Section~\ref{sec:threed_sr_w_approximation}, a closely related optimisation problem in which the objective is to construct a matching that is, in terms of a specific measure, as stable as possible. We show that an existing approximation algorithm for a different model of 3DR can be used to devise a $9/4$-approximation algorithm for this problem (Theorem~\ref{thm:threed_sr_w_approxalgofournine}).

Finally, in Section~\ref{sec:threed_sr_w_conclusion}, we recap on our results and discuss some directions for future work.

An instance of 3DR-W comprises a set $N$ of $3n$ agents and a preference list of each agent $\alpha_i$, labelled $P_{\alpha_i}$, that describes a strict order over all agents in $N \setminus \{ \alpha_i \}$. We say that an agent $\alpha_i$ \emph{prefers} $\alpha_j$ to $\alpha_k$, denoted $\alpha_j \succ_{\alpha_i} \alpha_k$, if $\alpha_j$ precedes $\alpha_k$ in $P_{\alpha_i}$.  A \emph{triple} is an unordered set of three agents. In order to compare triples, agents in an instance of 3DR-W use \emph{$\mathscr{W}$-preferences}, which are defined as follows. For any agent $\alpha_i$ and set of agents $S \subseteq N$ we denote by $\mathscr{W}_{\alpha_i}(S)$ the least-preferred agent in $S \setminus \{ \alpha_i \}$ according to $\alpha_i$. For any agent $\alpha_i$ and any two triples $r$ and $s$, we say that $\alpha_i$ \emph{prefers} $r$ to $s$, denoted $r \succ_{\alpha_i} s$, if $\mathscr{W}_{\alpha_i}(r) \succ_{\alpha_i} \mathscr{W}_{\alpha_i}(s)$. A \emph{matching} is a partition of $N$ into $n$ triples. Given an agent $\alpha_i$ and a matching $M$, we denote by $M(\alpha_i)$ the triple in $M$ that contains $\alpha_i$. Given a matching $M$, we say that a triple $t$ is \emph{blocking} if each agent $\alpha_i$ in $t$ prefers $t$ to $M(\alpha_i)$. A matching is \emph{stable} if it does not contain a blocking triple. Let $\mathscr{W}_{\alpha_i}(M)$ be short for $\mathscr{W}_{\alpha_i}(M(\alpha_i))$. Let $P$ be the collection of preference lists  $P_{\alpha_i}$ for each agent $\alpha_i$. For any instance $(N, P)$ of 3DR-W and any matching $M$, we denote by $\textrm{bt}(M, (N, P)) \subseteq \binom{N}{3}$ the set of triples that block $M$ in $(N, P)$. Conversely, we denote by $\textrm{nbt}(M, (N, P)) = \binom{N}{3} \setminus \textrm{bt}(M, (N, P))$ the set of triples that do not block $M$ in $(N, P)$. When the instance in question is clear from context, we simply write $\textrm{bt}(M)$ or $\textrm{nbt}(M)$. 

% The following definition of 3DR-W is identical to the definition of 3DR-B 
% except the agents in an instance of 3DR-W compare triples using $\mathscr{W}$-preferences instead of $\mathscr{B}$-preferences, which can be formally defined as follows.
% For any agent $\alpha_i$ and set of agents $S \subseteq N$ we denote by $\mathscr{W}_{\alpha_i}(S)$ the least-preferred agent in $S \setminus \{ \alpha_i \}$ according to $\alpha_i$. For any agent $\alpha_i$ and any two triples $r$ and $s$, we say that $\alpha_i$ \emph{prefers} $r$ to $s$, denoted $r \succ_{\alpha_i} s$, if $\mathscr{W}_{\alpha_i}(r) \succ_{\alpha_i} \mathscr{W}_{\alpha_i}(s)$. All of the other notation and terminology used in this chapter is defined as for 3DR-B in Chapter~\ref{c:threed_sr_b}.
% In this chapter we formalise a model of 3DR that involves $\mathcal{W}$-preferences and consider in this formalism the existence of, and complexity of finding, stable matchings.
% Here, instead of $\mathscr{B}$-preferences, we use $\mathscr{W}$-preferences, which are defined as follows. Each agent $\alpha_i$ to supply an ordinal preference list $P_{\alpha_i}$. $P_{\alpha_i}$ describes a total order on $N\setminus \{ \alpha_i \}$. 
% % In the (two-dimensional) Stable Roommates Problem \cite{GS62}\cite{Irv85} such a preference list exactly describes an agent's preference between any two possible pairs that they may belong to. Here we extend agents' preference lists to a preference relation between possible triples. This extension from preferences over individuals to preferences over sets of individuals has been well studied in the context of computational social choice \cite{BBP04}\cite{Pattanaik1984} and has been applied in the related field of Hedonic Games (also referred to as Stable Partition problems) \cite{HOCSC16} \cite{CH04} \cite{CH04a}. In this context we apply \textit{$\mathscr{W}$-preferences}, which we define as follows. 
% Given an agent $\alpha_i$ and a set $S\subseteq N$ let $\mathscr{W}_{\alpha_i}(S)$ be the least-preferred agent in $S \setminus \{ \alpha_i \}$ according to $P_{\alpha_i}$.  For agents $\alpha_i,\alpha_j,\alpha_k,\alpha_l,\alpha_m$, we say that $\alpha_i \in N$ \textit{prefers} one triple $r_1$ to another $r_2$, written $r_1 \succ_{\alpha} r_2$, if $\mathscr{W}_{\alpha_i}(r_1) \succ_{\alpha_i} \mathscr{W}_{\alpha_i}(r_2)$. an agent's preference between matchings is inferred. agent $\alpha_i$ \textit{prefers} matching $M$ to $M'$, written $M \succ_{\alpha_i} M'$, if $M(\alpha_i) \succ_{\alpha_i} M'(\alpha_i)$. Note that for any $\alpha_i \in N$, whilst $P_{\alpha_i}$ is a total order on $N\setminus \{ \alpha_i \}$, in this model using $\mathscr{W}$-preferences do not produce a total order of all triples that contain $\alpha_i$. For example, suppose $\alpha_i, \alpha_j, \alpha_k, \alpha_l \in N$ where $P_{\alpha_i} = \alpha_j, \alpha_k, \alpha_l, \dots$. Neither $\{\alpha_i, \alpha_j, \alpha_l \} \succ_{\alpha_i} \{\alpha_i, \alpha_k, \alpha_l \}$ nor $\{\alpha_i, \alpha_k, \alpha_l \} \prec_{\alpha_i} \{\alpha_i, \alpha_j, \alpha_l \}$ holds.

% % We say that a triple $r=\{\alpha_i, \alpha_j, \alpha_k\}$ \textit{blocks} matching $M$ if $r \succ_{\alpha_i} M(\alpha_i)$, $r \succ_{\alpha_j} M(\alpha_j)$, and $r \succ_{\alpha_k} M(\alpha_k)$. We say that a triple is \emph{stable} if it does not block $M$. Given a matching $M$, if no three agents in $N$ form a triple that blocks $M$ then we say that $M$ is a \textit{stable matching}. We say that an instance $(N,P)$ of 3D-SR-W \emph{contains} or \emph{admits} a stable matching if there exists a stable matching in $(N,P)$.

% % \begin{model}The Stable Roommates problem With Triple Rooms and $\mathscr{W}$-preferences (3D-SR-W)\\
% % \label{prob:threed_sr_w}\hspace*{8pt}\inp $(N,P)$ where:\\
% % \hspace*{16pt} $N=\{\alpha_1, \dots, \alpha_{3n}\}$ is the set of agents, for $n\geq 1$\\
% % \hspace*{16pt} $P=\bigcup\limits_{\alpha_i\in N} P_{\alpha_i}$ where $P_{\alpha_i}$ is the the strict preference list of $\alpha_i$ over $N \setminus \{ \alpha_i \}$\\
% % \hspace*{8pt}\verificationproblem Is a given matching in $(N,P)$ stable using $\mathscr{W}$-preferences?\\
% % \hspace*{8pt}\existenceproblem Does a stable matching exist in $(N,P)$ using $\mathscr{W}$-preferences?
% % \begin{adjustwidth}{8pt}{}
% % \constructionproblem Construct a matching in $(N,P)$ that is stable using $\mathscr{W}$-preferences, or report that no such matching exists.
% % \end{adjustwidth}
% % \end{model}

% % It is straightforward to show that the problem of deciding if an instance of 3D-SR-W contains a stable matching belongs to $\NP$. Our main result is that that this problem, which we refer to as the 3D-SR-W decision problem, is $\NP$-complete.

