In the previous chapter we considered the existence of stable matchings in a model of Three-Dimensional Roommates with additively separable preferences, called 3DR-AS. We showed that in general, a stable matching may not exist in a given instance of 3DR-AS, and the associated decision problem is $\NP$-complete. We also showed that if the agents' preferences are sufficiently restricted then a stable matching must always exist, which can be found in polynomial time. In this chapter we consider three alternative solution concepts, one of which is a strictly weaker concept than stability. For each concept, we study the existence of such matchings under different restrictions on the agents' preferences, and the computational complexity of the associated existence and construction problems (see Chapter~\ref{c:lit_review}). This culminates in a full complexity classification, which includes for each of the three solution concepts a dichotomy between polynomial-time solvability and $\NP$-hardness.

The three solution concepts that we study all relate to matchings in which there exist no two agents $\alpha_i$ and $\alpha_j$ where $\alpha_i$ would prefer to swap with $\alpha_j$. In such a case we say that $\alpha_i$ has \emph{envy} for $\alpha_j$. If a matching $M$ contains no agent with envy for another agent then we say that it is \emph{envy-free}. The other two solution concepts involve the other agents in the triple of $\alpha_j$, $M(\alpha_j)$. Informally, we say that $\alpha_i$ has \emph{justified envy} (abbreviated j-envy) for $\alpha_j$ if $\alpha_i$ has envy for $\alpha_j$ and each of the other agents in $M(\alpha_j)$ prefer $\alpha_i$ to $\alpha_j$. We say that $\alpha_i$ has \emph{weakly justified envy} (wj-envy) for $\alpha_j$ if $\alpha_i$ has envy for $\alpha_j$ and each of the other agents in $M(\alpha_j)$ either prefers $\alpha_i$ to $\alpha_j$ or is indifferent. Formally, an agent $\alpha_i$ has envy for another agent $\alpha_j$ in a matching $M$ if $u_{\alpha_i}(M(\alpha_j) \setminus \{ \alpha_j \}) > u_{\alpha_i}(M)$. If $\alpha_i$ has envy for $\alpha_j$ and $v_{\alpha_k}(\alpha_i) > v_{\alpha_k}(\alpha_j)$ for each $\alpha_k \in M(\alpha_j) \setminus \{ \alpha_j \}$ then we say that $\alpha_i$ has j-envy for $\alpha_j$. If $v_{\alpha_k}(\alpha_i) \geq v_{\alpha_k}(\alpha_j)$ for each $\alpha_k \in M(\alpha_j) \setminus \{ \alpha_j \}$ then we say that $\alpha_i$ has wj-envy for $\alpha_j$. The definitions of j-envy-free and wj-envy-free matchings are analogous.

These three solution concepts are hierarchical: by definition, any matching that is envy-free is also wj-envy-free, and any matching that is wj-envy-free must also be j-envy-free. In fact, they are also related to other solution concepts proposed in the literature. It is relatively straightforward to show that any envy-free matching is also \emph{strictly swap stable} \cite{Bilo22}. It is also straightforward to show that any stable matching is also j-envy-free. In fact, j-envy-freeness is a strictly weaker concept than stability. With the results of Chapter~\ref{c:threed_sr_as} in mind, this observation partly motivates our study of j-envy-freeness, since for example it would be interesting if a strictly weaker restriction on the agents' preferences than binary and symmetric valuations (which guarantees the existence of a stable matching) is sufficient to guarantee the existence of a j-envy-free matching.

% In this chapter, we study in 3DR-AS the existence of matchings that satisfy alternative solution concepts. 
% In this chapter we consider the existence of envy-free, weakly justified envy-free, and justified envy-free matchings in 3DR-AS (defined in Chapter~\ref{c:threed_sr_as}) and the complexity of the associated existence and construction problems. For each of the three solution concepts, we consider various restrictions on the agents' valuations.

A strong motivation also exists for combining these three solution concepts with a setting of fixed-size coalitions (and of size three). As we discussed in Chapter~\ref{c:lit_review}, in a model in which coalitions have arbitrary size, such as a hedonic game, it can be trivial to construct partitions that are envy-free by, for example, placing all agents into the grand coalition \cite{BY19,Ued18}.

We begin in Section~\ref{sec:threed_efr_as_ef} by showing that an arbitrary instance of 3DR-AS may not contain an envy-free matching, even when preferences are binary and symmetric and the maximum degree of the underlying graph is $2$. We describe a polynomial-time algorithm for this case that can either construct an envy-free matching or report that no such matching exists (Theorem~\ref{thm:threed_efr_as_ef_algorithm}). We then contrast this result by showing that the corresponding existence problem is $\NP$-complete even when the maximum degree of the underlying graph is $3$ (Theorem~\ref{thm:threed_efr_as_regularenvy_npcomplete}).

In Section~\ref{sec:threed_efr_as_wjef}, we identify a similar dichotomy for wj-envy-freeness. We first show that a wj-envy-free matching may not exist, even when preferences are binary and symmetric and the maximum degree of the underlying graph is $2$. Notably, the set of instances of 3DR-AS with maximum degree $2$ that do not contain a wj-envy-free matching is a strict subset of the set of instances with maximum degree $2$ that do not contain an envy-free matching. We describe a slightly more complex polynomial-time algorithm for this case, compared to the corresponding algorithm in Section~\ref{sec:threed_efr_as_ef}, that can either construct a wj-envy-free matching or report that no such matching exists (Theorem~\ref{thm:threed_efr_as_wjef_algowjpathscycles}). As for envy-freeness, we show that the corresponding existence problem is also $\NP$-complete even when the maximum degree of the underlying graph is $3$ (Theorem~\ref{thm:threed_efr_as_wjef_npcomplete}).

Next, in Section~\ref{sec:threed_efr_as_jef} we consider j-envy-freeness. We first remark that any stable matching is also j-envy-free. We then show that if preferences are binary but not necessarily symmetric, a j-envy-free matching must exist and can be found in polynomial time (Theorem~\ref{thm:threed_efr_as_jef_binary_algorithm}). Significantly, this tractability result holds in a larger set of instances of 3DR-AS than the corresponding result for stability, which we saw in Chapter~\ref{c:threed_sr_as}. Nevertheless, we complement this result with two hardness results. The first is that a given instance of 3DR-AS may not contain a j-envy-free matching even when preferences are ternary but not symmetric, and the associated existence problem is $\NP$-complete (Theorem~\ref{thm:threed_efr_as_jef_terasym_npcomplete}). The second is that a given instance of 3DR-AS may not contain a j-envy-free matching even when preferences are non-binary and symmetric, and the associated existence problem is $\NP$-complete (Theorem~\ref{thm:threed_efr_as_jef_symmetric_6_npcomplete}).

Finally, in Section~\ref{sec:threed_efr_as_conclusion}, we recap on our contribution and discuss some directions for future work.